# 111: Signed Permutation Matrices (Hyperoctahedral Group)

**Category**: algebraic
**Gain type**: expressivity
**Source**: Coxeter group theory; connection to neural network weight matrices
**Paper**: [papers/householder-product-parameterization.pdf] (DeltaProduct — expressivity analysis)
**Documented**: 2026-02-11

## Description

Signed permutation matrices — matrices with exactly one nonzero entry per row and column, where each entry is $\pm 1$ — form the **hyperoctahedral group** $B_n$, also known as the Coxeter group of type $B_n$. This group is the natural common generalization that unifies Householder reflections and permutation matrices: it contains all permutation matrices (a nonzero entry of $+1$) and all coordinate reflections (diagonal matrices with $\pm 1$ entries), and is generated by transpositions and sign flips. Both Householder reflections and permutation transpositions are involutions inside the orthogonal group $O(n)$, and the hyperoctahedral group is the maximal finite subgroup of $O(n)$ generated by these two kinds of involutions.

This algebraic structure is directly relevant to sequence models: state-tracking requires simulating permutation groups, and the Cartan-Dieudonné theorem shows that any orthogonal matrix (including any signed permutation) decomposes into at most $n$ Householder reflections. The hyperoctahedral group provides the tightest finite-group envelope for understanding what products of reflections and permutations can express.

## Mathematical Form

**Core Definition:**

$$
B_n = \{ M \in \{-1, 0, +1\}^{n \times n} : M \text{ has exactly one nonzero entry per row and column} \}
$$

Equivalently, $B_n$ is the **wreath product** $\mathbb{Z}_2 \wr S_n = \mathbb{Z}_2^n \rtimes S_n$, where:
- $S_n$ is the symmetric group (permutations)
- $\mathbb{Z}_2^n$ is the group of sign changes (diagonal $\pm 1$ matrices)

**Key Definitions:**

- $|B_n| = 2^n \cdot n!$ — order of the group
- $S_n \subset B_n \subset O(n)$ — chain of subgroups: permutations $\subset$ signed permutations $\subset$ orthogonal group
- Every $M \in B_n$ can be written as $M = D \cdot P$ where $D = \text{diag}(\pm 1, \ldots, \pm 1)$ and $P \in S_n$

**Generators (Coxeter presentation):**

As a Coxeter group of type $B_n$, it is generated by:
- $s_0$: a sign change on the first coordinate (coordinate reflection)
- $s_1, \ldots, s_{n-1}$: adjacent transpositions $(i, i+1)$

with relations:
$$
s_i^2 = e, \quad (s_0 s_1)^4 = e, \quad (s_i s_{i+1})^3 = e \text{ for } i \geq 1, \quad (s_i s_j)^2 = e \text{ for } |i-j| \geq 2
$$

**Reflections in $B_n$:**

The full set of reflections (involutions that fix a hyperplane) consists of:
$$
\{(ij)(\bar{i}\bar{j}) : 1 \leq i < |j| \leq n\} \cup \{(i\bar{i}) : i \in [n]\}
$$

where $(ij)(\bar{i}\bar{j})$ swaps coordinates $i, j$ and simultaneously swaps their signs, and $(i\bar{i})$ negates coordinate $i$.

## Similarity: Householder Reflections vs Permutation Transpositions

| Property | Householder Reflection $H = I - 2vv^\top$ | Permutation Transposition $P_{ij}$ |
|----------|------------------------------------------|-------------------------------------|
| Involution | $H^2 = I$ | $P_{ij}^2 = I$ |
| Orthogonal | $H^\top H = I$ | $P_{ij}^\top P_{ij} = I$ |
| Determinant | $\det(H) = -1$ | $\det(P_{ij}) = -1$ |
| Eigenvalues | $\{-1, 1, \ldots, 1\}$ | $\{-1, 1, \ldots, 1\}$ |
| Rank-1 deviation from $I$ | $H = I - 2vv^\top$ (rank 1) | $P_{ij} = I - (e_i - e_j)(e_i - e_j)^\top$ (rank 2, but special structure) |
| Generates full group | Products generate $O(n)$ | Products generate $S_n$ |
| Member of $B_n$ | Only if $v$ is a standard basis vector | Always |

**Key insight:** A permutation transposition $P_{ij}$ *is* a Householder reflection with $v = \frac{1}{\sqrt{2}}(e_i - e_j)$:
$$
P_{ij} = I - (e_i - e_j)(e_i - e_j)^\top = I - 2 \cdot \frac{(e_i - e_j)}{\sqrt{2}} \cdot \frac{(e_i - e_j)^\top}{\sqrt{2}}
$$

So **every transposition is a Householder reflection**, but not every Householder reflection is a permutation matrix.

## Differences

| Aspect | Householder Reflections | Permutation Matrices |
|--------|------------------------|---------------------|
| **Continuous vs discrete** | Continuous family (parameterized by $v \in \mathbb{R}^n$) | Finite set ($n!$ elements) |
| **Group generated** | $O(n)$ — full orthogonal group (Lie group, uncountable) | $S_n$ — symmetric group (finite, $n!$ elements) |
| **Differentiability** | Smooth parameterization, gradient-friendly | Not differentiable (discrete), requires relaxation |
| **Factorization length** | Any $Q \in O(n)$ needs $\leq n$ reflections | Any $\sigma \in S_n$ needs $\leq n-1$ transpositions |
| **Efficient hardware** | Sequential $O(dn_h)$ mat-vec; WY for parallel | $O(n)$ mat-vec via index permutation; trivially parallel |
| **Monoid homomorphism** | Products of Householder matrices form a monoid under composition (associative, has identity); maps to $O(n)$ | Products of permutation matrices form a monoid (the transformation monoid); maps to $S_n$ |
| **Spectral norm** | Always $= 1$ (orthogonal) | Always $= 1$ (orthogonal) |

## Complexity

| Operation | Householder Reflection | Permutation | Signed Permutation |
|-----------|----------------------|-------------|-------------------|
| Storage | $O(n)$ (vector $v$) | $O(n)$ (index array) | $O(n)$ (index array + signs) |
| Mat-vec | $O(n)$ | $O(n)$ | $O(n)$ |
| Product of $k$ | $O(nk)$ mat-vec | $O(n)$ composition | $O(n)$ composition |
| Parameterize full group | $O(n^2)$ ($n$ reflections) | $O(n \log n)$ ($n-1$ transpositions) | $O(n \log n + n)$ |

## Applicability

- **State-tracking in linear RNNs:** DeltaProduct shows that $n_h$ Householder reflections can simulate permutations of up to $n_h + 1$ elements, directly linking the two generator types
- **Orthogonal weight matrices:** The hyperoctahedral group provides a rich finite subgroup of $O(n)$ that includes both permutations and reflections, useful as a structured weight class
- **Regular language recognition:** Transition monoids of finite automata are submonoids of $B_n$ for DFAs recognizing regular languages, connecting to the algebraic theory of automata
- **Efficient fine-tuning:** Group-and-Shuffle and BOFT methods use products of block-diagonal orthogonal matrices interleaved with permutations, operationally staying within structured subgroups of $O(n)$

## Limitations

- The hyperoctahedral group $B_n$ has $2^n n!$ elements — exponentially large but still finite; it cannot represent arbitrary rotations
- Signed permutations are sparse matrices ($n$ nonzeros in $n \times n$), limiting expressivity per matrix
- Composing many signed permutations quickly reaches the full group, so the "structured" advantage is mainly for individual matrices or short products
- No standard differentiable parameterization of $B_n$ exists; must use relaxation (Sinkhorn, Gumbel, or Householder products)

## Implementation Notes

```python
import torch

def signed_permutation_matvec(perm_indices, signs, x):
    """
    Apply signed permutation matrix M = D @ P to vector x.
    M[i, perm_indices[i]] = signs[i]

    Args:
        perm_indices: (n,) - permutation as index array
        signs: (n,) - +1 or -1 for each row
        x: (n,) - input vector

    Returns:
        (n,) - M @ x = signs * x[perm_indices]
    """
    return signs * x[perm_indices]


def transposition_as_householder(i, j, n):
    """
    Express transposition P_{ij} as a Householder reflection vector.
    P_{ij} = I - 2 v v^T  where  v = (e_i - e_j) / sqrt(2)
    """
    v = torch.zeros(n)
    v[i] = 1.0 / (2 ** 0.5)
    v[j] = -1.0 / (2 ** 0.5)
    return v  # Householder vector


def hyperoctahedral_decompose(perm_indices, signs):
    """
    Decompose signed permutation M = D @ P into:
    - P: permutation matrix (index array)
    - D: diagonal sign matrix
    """
    return perm_indices, signs
```

## References

- Coxeter, H.S.M. (1935). The complete enumeration of finite groups of the form $R_i^2 = (R_i R_j)^{k_{ij}} = 1$.
- Wikipedia: Hyperoctahedral group. https://en.wikipedia.org/wiki/Hyperoctahedral_group
- Schlag et al. (2025). DeltaProduct: Improving State-Tracking in Linear RNNs via Householder Products. ICLR 2025.
- Humphreys, J. (1990). Reflection Groups and Coxeter Groups. Cambridge University Press.
