# 069: Krohn-Rhodes Monoid Decomposition

**Category**: algebraic
**Gain type**: expressivity
**Source**: Krohn and Rhodes (1965); Diekert, Kufleitner, and Steinberg (2011). The Krohn-Rhodes Theorem and Local Divisors.
**Paper**: papers/krohn-rhodes-theorem.pdf
**Documented**: 2026-02-11

## Description

The Krohn-Rhodes theorem is the "Jordan-Hölder theorem for monoids" — it states that every finite transformation monoid (hence every finite-state automaton) can be decomposed as a wreath product of simple groups and a 3-element aperiodic monoid $U_2$ (the "flip-flop"). This directly answers the user's question about whether matrix multiplication is a "universal primitive" for simulating arbitrary monoids.

**Answer to the universality question:** Matrix multiplication over $\mathbb{R}^{n \times n}$ is NOT a universal monoid in the algebraic sense. Here's the precise picture:

1. **Every finite monoid embeds in a matrix monoid** — this is the Cayley representation theorem. Given a finite monoid $M$ with $|M| = n$, each element $m$ acts on $M$ by left-multiplication, giving an $n \times n$ $\{0,1\}$-matrix. So yes, standard matmul can *represent* any finite monoid.

2. **But the Krohn-Rhodes theorem reveals a more efficient decomposition**: any finite transformation monoid is a divisor of an alternating wreath product $(\{a,b\}, U_2) \wr (G_1, G_1) \wr \cdots \wr (G_m, G_m)$ where each $G_i$ is a finite simple group dividing $M$. The wreath product operation $(f, n) \cdot (g, k) = (f + (n * g), nk)$ is *not* a standard matmul — it's a semidirect product with a group action.

3. **For practical SSM design**, the question becomes: what is the *minimal* matrix size needed to faithfully simulate a desired monoid? Krohn-Rhodes tells us the complexity (number of group layers needed) is a fundamental invariant of the computation, independent of matrix representation.

**Key insight for SSMs:** The state transition monoid of a sequence model determines what patterns it can detect. Different monoid structures (groups, aperiodic semigroups, their wreath products) correspond to different language-theoretic capabilities. Matrix multiplication can simulate all finite monoids but may require exponentially large matrices to do so efficiently — the wreath product decomposition is typically more compact.

## Mathematical Form

**Krohn-Rhodes Theorem (Theorem 4.1):**

Every finite transformation monoid $(X, M)$ strongly divides a wreath product of the form:

$$
(X_1, M_1) \wr (X_2, M_2) \wr \cdots \wr (X_n, M_n)
$$

where each factor $(X_i, M_i)$ is either:
- $(\{a, b\}, U_2)$ — the 2-state flip-flop (aperiodic), or
- $(G, G)$ — for some non-trivial simple group $G$ dividing $M$

**Key Definitions:**

- **Transformation monoid** $(X, M)$: a set $X$ (states) and monoid $M$ acting on $X$ via $X \times M \to X$
- **Wreath product** $(X, M) \wr (Y, N)$: acts on $X \times Y$ with monoid $M^Y \rtimes N$
  - Elements: pairs $(f, n)$ where $f: Y \to M$ and $n \in N$
  - Multiplication: $(f, n) \cdot (g, k) = (f + (n * g), nk)$ where $(n * g)(y) = g(y \cdot n)$
- **Division** $M \prec N$: $M$ is a homomorphic image of a submonoid of $N$
- **Local divisor** $M_c$ at $c \in M$: the monoid $(cMc \cup \{c\}, \circ, c)$ where $m \circ n = mcn$

**Complexity bound (Corollary 4.2):**

The number $n$ of factors in the decomposition satisfies:

$$
n < |M| \cdot (|M| + |X|) \cdot 2^{|M|}
$$

**The flip-flop monoid $U_2$:**

$$
U_2 = \{1, a, b\}, \quad a^2 = a, \quad b^2 = b, \quad ab = a, \quad ba = b
$$

$U_2$ contains only idempotents (no non-trivial groups). It is the "atom" of non-invertible computation — the simplest element that can map two states to one (lose information).

**Matrix representation of $U_2$:**

$$
a \mapsto \begin{bmatrix} 1 & 0 \\ 1 & 0 \end{bmatrix}, \quad b \mapsto \begin{bmatrix} 0 & 1 \\ 0 & 1 \end{bmatrix}, \quad 1 \mapsto \begin{bmatrix} 1 & 0 \\ 0 & 1 \end{bmatrix}
$$

Note: these matrices have eigenvalues $\{0, 1\}$ — they are *not* in any unit-eigenvalue group!

**Decomposition via local divisors (Theorem 3.1):**

For a faithful transformation monoid $(X, M)$ generated by $A$ and any non-unit $c \in A$:

$$
\overline{(X, M)} \prec \overline{(Xc, M_c)} \wr \overline{(X \dot\cup N, N)}
$$

where $M_c$ is the local divisor at $c$ and $N = \langle A \setminus \{c\} \rangle$. Iterating this until all generators are units yields the full decomposition.

## Complexity

| Aspect | Cayley Representation | Krohn-Rhodes |
|--------|-----------------------|-------------|
| Matrix size for monoid $M$ | $|M| \times |M|$ | Product of $|G_i| + 2$ |
| Number of layers | 1 (monolithic) | $< |M| \cdot (|M| + |X|) \cdot 2^{|M|}$ |
| Detects aperiodic patterns | Yes (but wastefully) | Via $U_2$ components |
| Detects group structure | Yes (but wastefully) | Via simple group components |

**Computational complexity of finding the decomposition:** The Krohn-Rhodes complexity (minimum number of group layers) was recently shown to be decidable for complexity $c = 1$ (Margolis, Rhodes, Schilling, 2024).

## Applicability

- **Understanding SSM expressivity**: The transition monoid of an SSM determines what formal languages it recognizes. Aperiodic monoids ↔ star-free languages, group-containing monoids ↔ group languages
- **Minimal state representations**: Instead of $n \times n$ matrices, a wreath product decomposition may give a more parameter-efficient representation of the desired computation
- **Connecting SSMs to automata theory**: Recent work (arXiv:2505.11694) shows neural networks can exactly simulate DFAs — Krohn-Rhodes provides the algebraic foundation for understanding when and how
- **Answering "is matmul universal?"**: Yes, every finite monoid embeds in a matrix monoid. But the embedding may be exponentially wasteful — the wreath product structure is typically more efficient

## Limitations

- **Infinite-state models**: Krohn-Rhodes applies to *finite* monoids. SSMs with continuous states are infinite, so the theorem gives guidance but not direct decomposition
- **Decomposition size**: The bound $n < |M|(|M| + |X|)2^{|M|}$ is exponential — the decomposition can be very large
- **Computing the decomposition is hard**: Finding the optimal Krohn-Rhodes complexity is undecidable in general (known decidable only for $c = 0, 1$)
- **Hardware mismatch**: Wreath products are not native hardware operations — they must be simulated via matrix operations, potentially losing the structural advantage
- **Not a practical parameterization**: This is primarily a theoretical tool for understanding expressivity, not a directly implementable layer type

## Implementation Notes

```python
# Conceptual: simulating a wreath product decomposition
# The wreath product (X,M) ≀ (Y,N) acts on X × Y
# Element (f, n) where f: Y → M and n ∈ N
# (f,n) · (g,k) = (f + (n*g), n·k)  where (n*g)(y) = g(y·n)

# For SSMs, the key takeaway is:
# 1. Standard matmul CAN represent any finite monoid
# 2. But may need n×n matrices for a monoid of size n
# 3. Wreath product gives a more structured decomposition
# 4. The aperiodic part (U_2) handles "forgetting" (eigenvalue 0)
# 5. The group part handles "rotation" (eigenvalues on unit circle)

# This suggests SSM state matrices should combine:
# - Orthogonal/unitary components (group part, |λ|=1)
# - Idempotent/projective components (aperiodic part, λ ∈ {0,1})
# ... which is exactly what gated SSMs do!

class WreathProductLayer:
    """Conceptual wreath product: not hardware-optimized"""
    def __init__(self, group_dim, aperiodic_states):
        self.group = OrthogonalMatrix(group_dim)  # |λ| = 1
        self.gate = nn.Sigmoid(aperiodic_states)   # λ ∈ (0,1) → soft U_2

    def forward(self, state, input):
        # Group component: rotate without decay
        rotated = self.group(state)
        # Aperiodic component: gate (forget/remember)
        gate = self.gate(input)
        return gate * rotated + (1 - gate) * input
```

## References

- Krohn and Rhodes (1965). Algebraic Theory of Machines. I. Prime Decomposition Theorem for Finite Semigroups and Machines.
- Diekert, Kufleitner, and Steinberg (2011). The Krohn-Rhodes Theorem and Local Divisors. arXiv:1111.1585.
- Eilenberg (1976). Automata, Languages, and Machines, Vol. B.
- Margolis, Rhodes, and Schilling (2024). Decidability of Krohn-Rhodes Complexity $c = 1$.
